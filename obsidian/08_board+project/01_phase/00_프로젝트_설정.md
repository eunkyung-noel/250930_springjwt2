# 1단계: 인증 및 기본 CRUD

## 0. 프로젝트 설정

게시판 프로젝트의 첫 단계는 Spring Boot 프로젝트를 초기화하고, 필요한 의존성을 설정하며, 개발 환경에 맞는 기본 구성을 완료하는 것입니다. 이 단계에서는 데이터베이스 연결, Spring Security 설정, JWT 및 Redis 연동에 필요한 기본 틀을 마련합니다.

### 1. `build.gradle` 의존성 설정

`build.gradle` 파일은 프로젝트의 의존성, 플러그인, 빌드 구성을 관리하는 핵심 파일입니다. 이번 프로젝트에서는 다음과 같은 주요 의존성을 사용합니다.

- **Spring Boot Starter Web**: 웹 애플리케이션 개발을 위한 기본 의존성 (Tomcat, Spring MVC 등 포함).
- **Spring Boot Starter Data JPA**: 데이터베이스 연동을 위한 JPA(Java Persistence API) 관련 기능 제공.
- **Spring Boot Starter Data Redis**: Redis 연동을 위한 기능 제공.
- **Spring Boot Starter Security**: 인증 및 인가 기능을 제공하는 Spring Security 연동.
- **Spring Boot Starter Thymeleaf**: 서버 사이드 렌더링을 위한 Thymeleaf 템플릿 엔진.
- **MySQL Connector/J**: MySQL 데이터베이스 드라이버.
- **jjwt**: JWT(JSON Web Token) 생성 및 검증을 위한 라이브러리.
- **Lombok**: 반복적인 코드(Getter, Setter, 생성자 등)를 줄여주는 라이브러리.

```groovy
// build.gradle

plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.5'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '17'
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // Spring Boot Starters
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-data-redis'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    implementation 'org.springframework.boot:spring-boot-starter-web'

    // Database
    runtimeOnly 'com.mysql:mysql-connector-j'

    // JWT
    implementation 'io.jsonwebtoken:jjwt-api:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.12.3'

    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // Test
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
}

tasks.named('test') {
    useJUnitPlatform()
}
```

### 2. `application.yml` 환경 설정

`application.yml` 파일은 애플리케이션의 주요 설정을 담당합니다. 특히, 데이터베이스 연결 정보, Redis 서버 정보, JWT 비밀키 및 만료 시간 등 민감한 정보와 환경별 구성 정보를 관리합니다.

#### 개발 환경 (`application-dev.yml`)

로컬 개발 환경에서는 H2 인메모리 데이터베이스나 로컬에 설치된 MySQL/Redis를 사용하여 빠르게 개발 및 테스트를 진행할 수 있습니다.

```yaml
# src/main/resources/application-dev.yml

spring:
  # 데이터베이스 설정 (로컬 MySQL 기준)
  datasource:
    url: jdbc:mysql://localhost:3306/board_db
    username: your_mysql_username
    password: your_mysql_password
    driver-class-name: com.mysql.cj.jdbc.Driver
  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: update # 애플리케이션 실행 시 엔티티 변경사항을 DB에 자동 반영
    show-sql: true # 실행되는 SQL 쿼리를 로그로 출력
    properties:
      hibernate:
        format_sql: true # SQL 로그를 보기 좋게 포맷팅

  # Redis 설정 (로컬 Redis 기준)
  data:
    redis:
      host: localhost
      port: 6379

# JWT 설정
jwt:
  secret: "your-super-secret-key-for-development-environment-1234567890" # 개발용 시크릿 키
  expiry:
    access: 3600000 # 1시간 (ms)
    refresh: 604800000 # 7일 (ms)
```

#### 운영 환경 (`application-prod.yml`)

운영 환경에서는 실제 서비스에 사용될 데이터베이스와 Redis 서버 정보를 설정합니다. 이 정보들은 보통 환경 변수(Environment Variable)를 통해 주입받아 보안을 강화합니다.

```yaml
# src/main/resources/application-prod.yml

spring:
  # 데이터베이스 설정 (환경 변수 사용)
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: validate # 운영 환경에서는 스키마 변경을 자동으로 수행하지 않고 검증만 함
    show-sql: false

  # Redis 설정 (환경 변수 사용)
  data:
    redis:
      host: ${SPRING_DATA_REDIS_HOST}
      port: ${SPRING_DATA_REDIS_PORT}
      password: ${SPRING_DATA_REDIS_PASSWORD} # 운영 환경에서는 비밀번호 사용 권장

# JWT 설정 (환경 변수 사용)
jwt:
  secret: ${JWT_SECRET_KEY} # 환경 변수로부터 시크릿 키 주입
  expiry:
    access: 1800000 # 30분 (ms)
    refresh: 2592000000 # 30일 (ms)
```

#### 기본 `application.yml`

기본 `application.yml` 파일에서는 공통 설정과 활성화할 프로파일을 지정합니다.

```yaml
# src/main/resources/application.yml

spring:
  profiles:
    active: dev # 기본 활성화 프로파일을 'dev'로 설정
    group:
      dev: "dev"
      prod: "prod"

  # JPA Auditing 활성화
  jpa:
    open-in-view: false # OSIV(Open Session In View) 비활성화 권장
```

> **💡 OSIV(Open Session In View)를 비활성화하는 이유**
> OSIV는 JPA 세션을 뷰 렌더링 시점까지 열어두어 지연 로딩(Lazy Loading)을 편리하게 해주지만, 다음과 같은 단점이 있습니다.
>
> - **성능 저하**: 세션이 오래 열려있어 데이터베이스 커넥션 풀이 빠르게 고갈될 수 있습니다.
> - **예상치 못한 쿼리 발생**: 뷰 렌더링 과정에서 N+1 문제와 같은 의도치 않은 쿼리가 발생할 수 있습니다.
>
> `spring.jpa.open-in-view: false`로 설정하면 트랜잭션 범위 내에서만 세션이 유지되므로, 서비스 계층에서 필요한 모든 데이터를 명시적으로 조회해야 합니다. 이는 더 예측 가능하고 안정적인 애플리케이션을 만드는 데 도움이 됩니다.

이제 프로젝트의 기본 설정이 완료되었습니다. 다음 단계에서는 이 설정을 바탕으로 실제 인증 및 인가 기능을 구현해 보겠습니다.
